---
config:
  themeVariables:
    fontSize: '16px'
---
flowchart TB
    subgraph SOURCES["ğŸ“Š SOURCES DE DONNÃ‰ES"]
        direction TB
        subgraph IMS["ğŸ¢ IMS - Base de donnÃ©es principale"]
            S1["ğŸ“ Source 1: AZEC<br>Anciens contrats<br>(2008-2020)"]
            S2["ğŸ“ Source 2: AZ<br>Contrats actuels<br>(Agents & Courtiers)"]
        end
        S3["ğŸ“‹ Source 3<br>Classification des produits"]
        S4["â˜ï¸ Source 4: OneBI<br>DonnÃ©es de primes Ã©mises"]
    end

    subgraph PROCESS["âš™ï¸ TRAITEMENT DES DONNÃ‰ES"]
        direction TB
        
        subgraph P1["ğŸ’š Processus 1: CAPITAUX"]
            P1_1["ğŸ“¥ Ã‰tape 1<br><b>RÃ©cupÃ©ration</b><br>Collecte des montants<br>garantis par contrat"]
            P1_2["ğŸ”„ Ã‰tape 2<br><b>Mise Ã  jour et fusion</b><br>â€¢ Ajustement des montants dans le temps<br>â€¢ Regroupement anciennes/nouvelles donnÃ©es<br>â€¢ Uniformisation des formats"]
            P1_3["ğŸ“¦ Ã‰tape 3<br><b>RÃ©sultat</b><br><br>Vue complÃ¨te des<br>montants garantis par contrat"]
        end
        
        subgraph P2["ğŸ’œ Processus 2: PORTEFEUILLE"]
            P2_1["ğŸ“¥ Ã‰tape 1<br><b>RÃ©cupÃ©ration</b><br>Collecte des contrats<br>anciens et actuels"]
            P2_2["ğŸ”„ Ã‰tape 2<br><b>Mise Ã  jour et fusion</b><br>â€¢ Nettoyage des doublons<br>â€¢ Regroupement anciennes/nouvelles donnÃ©es<br>â€¢ Classification par type de produit<br>â€¢ Classification par secteur d'activitÃ©"]
            P2_3["ğŸ“¦ Ã‰tape 3<br><b>RÃ©sultat</b><br><br>Vue complÃ¨te du<br>portefeuille par produit et secteur"]
        end
        
        subgraph P3["ğŸ§¡ Processus 3: Ã‰MISSIONS"]
            P3_1["ğŸ“¥ Ã‰tape 1<br><b>RÃ©cupÃ©ration</b><br>Collecte des primes<br>facturÃ©es aux clients"]
            P3_2["ğŸ”„ Ã‰tape 2<br><b>Mise Ã  jour et fusion</b><br>â€¢ VÃ©rification des montants<br>â€¢ Classification par type de produit<br>â€¢ Calcul des totaux par contrat<br>â€¢ Calcul des commissions"]
            P3_3["ğŸ“¦ Ã‰tape 3<br><b>RÃ©sultat</b><br><br>Vue complÃ¨te des primes<br>facturÃ©es et commissions par produit"]
        end
    end

    subgraph OUTPUTS["ğŸ“Š RÃ‰SULTATS FINAUX"]
        OUT1["âœ… Montants garantis<br>par contrat actualisÃ©s"]
        OUT2["âœ… Portefeuille de contrats<br>par produit et secteur"]
        OUT3["âœ… Primes facturÃ©es et<br>commissions par produit"]
    end

    %% Connexions optimisÃ©es Sources -> Processus
    IMS --> P1_1
    IMS --> P2_1
    S3 --> P1_2
    S3 --> P2_2
    S3 --> P3_2
    S4 --> P3_1

    %% Connexions internes Processus 1
    P1_1 --> P1_2
    P1_2 --> P1_3

    %% Connexions internes Processus 2
    P2_1 --> P2_2
    P2_2 --> P2_3

    %% Connexions internes Processus 3
    P3_1 --> P3_2
    P3_2 --> P3_3

    %% Connexions vers outputs
    P1_3 --> OUT1
    P2_3 --> OUT2
    P3_3 --> OUT3

    %% Styles
    classDef sourceStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:3px,color:#000
    classDef imsStyle fill:#F0F4FF,stroke:#1976D2,stroke-width:2px,color:#000
    classDef process1Style fill:#E8F5E8,stroke:#388E3C,stroke-width:2px,color:#000
    classDef process2Style fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px,color:#000
    classDef process3Style fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#000
    classDef outputStyle fill:#E1F5FE,stroke:#0277BD,stroke-width:3px,color:#000,font-weight:bold

    class S1,S2,S3,S4 sourceStyle
    class IMS imsStyle
    class P1_1,P1_2,P1_3 process1Style
    class P2_1,P2_2,P2_3 process2Style
    class P3_1,P3_2,P3_3 process3Style
    class OUT1,OUT2,OUT3 outputStyle