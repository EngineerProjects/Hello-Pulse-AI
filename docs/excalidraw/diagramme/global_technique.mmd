---
config:
  themeVariables:
    nodeWidth: '1000'
---
flowchart TB
 subgraph SOURCES["ğŸ“Š SOURCES DE DONNÃ‰ES"]
        A1@{ label: "ğŸ¢ **AZ** - DonnÃ©es Actuelles<br>ğŸ“‹ Contrats agents + courtiers<br>ğŸ“‹ Portefeuille en cours<br>ğŸ“‹ Chiffres d'affaires<br><br>Tables: PTF16.IPF, PTF36.IPF<br>PTF16a.IPFM99, PTF36a.IPFM99" }
        A2["ğŸ•’ **AZEC** - Historique MigrÃ©<br>ğŸ“‹ Anciens contrats 2008-2020<br>ğŸ“‹ Capitaux et garanties<br>ğŸ“‹ DonnÃ©es migrÃ©es<br><br>Tables: POLIC_CU<br>CAPITXCU.CAPITXCU"]
        A3["â˜ï¸ **OneBI** - Ã‰missions<br>ğŸ“‹ Primes Ã©mises dÃ©taillÃ©es<br>ğŸ“‹ Exercices comptables<br>ğŸ“‹ DonnÃ©es consolidÃ©es<br><br>Tables: rf_frl_prm_dtl_midcorp_m"]
        A4["ğŸ” RÃ©fÃ©rentiels MÃ©tier<br>ğŸ“‹ Segmentation produits<br>ğŸ“‹ Classification secteurs<br>ğŸ“‹ Coefficients rÃ©Ã©valuation<br><br>Tables: segmentprdt, INDICES<br>CLIENT1, CLIENT3"]
  end
 subgraph P1["ğŸ’œ **2. PORTEFEUILLE** - Contrats & Mouvements"]
        B1["ğŸ“¥ 2.1 Extraction DonnÃ©es Actuelles<br>ğŸ”¸ RÃ©cupÃ©ration contrats agents (PTF16)<br>ğŸ”¸ RÃ©cupÃ©ration contrats courtiers (PTF36)<br>ğŸ”¸ Filtrage marchÃ© Construction (CMARCH=6)<br>ğŸ”¸ Application rÃ¨gles business<br><br>ğŸ“‹ EntrÃ©es: PTF16.IPF, PTF36.IPF<br>ğŸ“‹ Sortie: MVT_CONST_PTF{vision} âœ¨ NOUVELLE"]
        B2["ğŸ“¥ 2.2 Extraction Historique MigrÃ©<br>ğŸ”¸ RÃ©cupÃ©ration polices anciennes AZEC<br>ğŸ”¸ RÃ©cupÃ©ration capitaux historiques<br>ğŸ”¸ Mise au format compatible AZ<br>ğŸ”¸ PrÃ©paration correspondance champs<br><br>ğŸ“‹ EntrÃ©es: POLIC_CU, CAPITXCU.CAPITXCU<br>ğŸ“‹ Sortie: AZEC_PTF{vision} âœ¨ NOUVELLE"]
        B3["ğŸ§¹ 2.3 Nettoyage &amp; Harmonisation<br>ğŸ”¸ Correction caractÃ¨res mal encodÃ©s UTF8â†’Latin9<br>ğŸ”¸ DÃ©tection rÃ©solution problÃ¨mes affichage<br>ğŸ”¸ Harmonisation structures AZ â†” AZEC<br>ğŸ”¸ Validation qualitÃ© des champs<br><br>ğŸ“‹ EntrÃ©es: MVT_CONST_PTF{vision}, AZEC_PTF{vision}<br>ğŸ“‹ Sorties: mÃªmes tables ğŸ”„ NETTOYÃ‰ES"]
        B4["ğŸ”— 2.4 Fusion Intelligente AZ + AZEC<br>ğŸ”¸ UNION donnÃ©es rÃ©centes AZ + historiques AZEC<br>ğŸ”¸ Mapping automatique POLICEâ†’NOPOL, PRODUITâ†’CDPROD<br>ğŸ”¸ Gestion pÃ©riodes chevauchement 2012-2020<br>ğŸ”¸ Marquage origine via DIRCOM traÃ§abilitÃ©<br><br>ğŸ“‹ EntrÃ©es: Tables AZ et AZEC nettoyÃ©es<br>ğŸ“‹ Sortie: MVT_PTF{vision} âœ¨ NOUVELLE"]
        B5["ğŸ¯ 2.5 Enrichissement MÃ©tier Standard<br>ğŸ”¸ Segmentation produits 47 rÃ¨gles business<br>ğŸ”¸ Classification ISIC secteurs activitÃ©<br>ğŸ”¸ Calculs indicateurs mouvements AFN/RES<br>ğŸ”¸ ContrÃ´les qualitÃ© automatiques<br><br>ğŸ“‹ EntrÃ©e: MVT_PTF{vision}<br>ğŸ“‹ Sortie: MVT_PTF{vision} ğŸ”„ ENRICHIE"]
        B6["ğŸ“¦ 2.6 Cube Final Portefeuille <br><br>ğŸ“‹ EntrÃ©e: MVT_PTF{vision} enrichie<br><br>ğŸ“‹ Sortie: CUBE.MVT_PTF{vision} âœ¨ NOUVELLE"]
        B7["ğŸ” 2.7 Enrichissement DataRisk Optionnel<br>ğŸ”¸ Import donnÃ©es externes risque OneBI<br>ğŸ”¸ Classifications spÃ©cialisÃ©es par mÃ©tier<br>ğŸ”¸ Analyses sectorielles complÃ©mentaires<br>ğŸ”¸ Informations marchÃ© et concurrence<br><br>ğŸ“‹ Sources: Tables externes OneBI<br>ğŸ“‹ Sorties: CUBE.ird_risk_qan_{vision}<br>CUBE.ird_risk_q45_{vision}<br>CUBE.ird_risk_q46_{vision} âœ¨ NOUVELLES"]
        n1["Untitled Node"]
  end
 subgraph P2["ğŸ§¡ **3. Ã‰MISSIONS** - Primes & Production"]
        C1["ğŸ“¥ 3.1 Extraction OneBI CentralisÃ©e<br>ğŸ”¸ RÃ©cupÃ©ration primes Ã©mises dÃ©taillÃ©es<br>ğŸ”¸ Focus marchÃ© Construction cd_marche=6<br>ğŸ”¸ SÃ©paration exercice courant/antÃ©rieur<br>ğŸ”¸ Exclusion donnÃ©es fictives et test<br><br>ğŸ“‹ EntrÃ©e: PRM.rf_frl_prm_dtl_midcorp_m<br>ğŸ“‹ Sorties: PRIMES_ONE_BI âœ¨ NOUVELLE<br>PRIMES_EMISES{vision}_OBI âœ¨ NOUVELLE"]
        C2["ğŸ§¹ 3.2 Nettoyage &amp; Validation<br>ğŸ”¸ Correction caractÃ¨res mal encodÃ©s<br>ğŸ”¸ VÃ©rification cohÃ©rence des donnÃ©es<br>ğŸ”¸ Uniformisation formats et types<br>ğŸ”¸ ContrÃ´les de vraisemblance<br><br>ğŸ“‹ EntrÃ©e: PRIMES_EMISES{vision}_OBI<br>ğŸ“‹ Sortie: PRIMES_EMISES{vision}_OBI_TR âœ¨ NOUVELLE"]
        C3["ğŸ¯ 3.3 Segmentation &amp; Classification<br>ğŸ”¸ Jointure avec rÃ©fÃ©rentiel produits<br>ğŸ”¸ Attribution catÃ©gories business<br>ğŸ”¸ Classification par marchÃ© et segment<br>ğŸ”¸ Validation cohÃ©rence mÃ©tier<br><br>ğŸ“‹ EntrÃ©es: PRIMES_EMISES{vision}_OBI_TR<br>SEG.segmentprdt_{vision}<br>ğŸ“‹ Sortie: PRIMES_EMISES{vision}_OBI_TR ğŸ”„ ENRICHIE"]
        C4["ğŸ“Š 3.4 AgrÃ©gations Business<br>ğŸ”¸ Regroupements par police<br>ğŸ”¸ Calculs par garantie dÃ©taillÃ©e GARP<br>ğŸ”¸ SynthÃ¨ses par contrat<br>ğŸ”¸ Calculs commissions associÃ©es<br><br>ğŸ“‹ EntrÃ©e: PRIMES_EMISES{vision}_OBI_TR enrichie<br>ğŸ“‹ Sortie: Tables agrÃ©gÃ©es ğŸ”„ CALCULÃ‰ES"]
        C5["ğŸ“¦ 3.5 Cubes Finaux Ã‰missions<br>ğŸ† DÃ©tail par garantie GARP<br>ğŸ† SynthÃ¨se par police<br>ğŸ† Primes exercice courant et antÃ©rieur<br>ğŸ† Commissions et marges calculÃ©es<br><br>ğŸ“‹ EntrÃ©e: Tables agrÃ©gÃ©es<br>ğŸ“‹ Sorties: CUBE.PRIMES_EMISES{vision}_POL_GARP âœ¨ NOUVELLE<br>CUBE.PRIMES_EMISES{vision}_POL âœ¨ NOUVELLE"]
  end
 subgraph P3["ğŸ’š **1. CAPITAUX** - Garanties & Couvertures"]
        D1["ğŸ“¥ 1.1 Extraction Capitaux Actuels<br>ğŸ”¸ RÃ©cupÃ©ration 14 types capitaux MTCAPI1-14<br>ğŸ”¸ Calculs plafonds par contrat<br>ğŸ”¸ Traitement garanties particuliÃ¨res<br>ğŸ”¸ Focus marchÃ© Construction<br><br>ğŸ“‹ EntrÃ©es: PTF16.IPF, PTF36.IPF<br>ğŸ“‹ Sorties: PTF_CONST_SMP_LCI{vision} âœ¨ NOUVELLE<br>_00_PTF_CONST_SMP_LCI{vision} âœ¨ NOUVELLE"]
        D2["ğŸ“¥ 1.2 Extraction Capitaux Historiques<br>ğŸ”¸ RÃ©cupÃ©ration capitaux anciens AZEC<br>ğŸ”¸ Traitements spÃ©ciaux donnÃ©es historiques<br>ğŸ”¸ Calculs plafonds SMP/LCI par type PE/DD<br>ğŸ”¸ Mise au format compatible AZ<br><br>ğŸ“‹ EntrÃ©e: CAPITXCU.CAPITXCU<br>ğŸ“‹ Sortie: _00_CAPITAUX_AZEC âœ¨ NOUVELLE"]
        D3["ğŸ’° 1.3 Indexation Ã  Valeur Ã‰conomique<br>ğŸ”¸ Application indices rÃ©Ã©valuation par poste 14 types<br>ğŸ”¸ Formule : MTCAPIi = MTCAPI Ã— INDXINTG/INDXORIG<br>ğŸ”¸ Gestion 4 indices par poste selon CDPRVB + date<br>ğŸ”¸ Harmonisation temporelle pour comparabilitÃ©<br><br>ğŸ“‹ EntrÃ©es: Tables AZ et AZEC + INDICES<br>ğŸ“‹ Sorties: mÃªmes tables ğŸ”„ INDEXÃ‰ES"]
        D4["ğŸ”— 1.4 Consolidation Finale<br>ğŸ”¸ Fusion intelligente capitaux AZ + AZEC<br>ğŸ”¸ Arbitrage et choix de la meilleure source<br>ğŸ”¸ Calculs business finaux harmonisÃ©s<br>ğŸ”¸ VÃ©rifications cohÃ©rence globale<br><br>ğŸ“‹ EntrÃ©es: Tables AZ et AZEC indexÃ©es<br>ğŸ“‹ Sortie: Table consolidÃ©e ğŸ”„ FUSIONNÃ‰E"]
        D5["ğŸ“¦ 1.5 Cube Final Capitaux<br>ğŸ† Capitaux Ã  valeur Ã©conomique actuelle<br>ğŸ† Plafonds harmonisÃ©s AZ + AZEC<br>ğŸ† Garanties classÃ©es par catÃ©gorie<br>ğŸ† Montants comparables dans le temps<br><br>ğŸ“‹ EntrÃ©e: Table consolidÃ©e<br>ğŸ“‹ Sortie: CUBE.AZ_AZEC_CAPITAUX_{vision} âœ¨ NOUVELLE"]
  end
    A1 --> B1 & D1
    A2 --> B2 & D2
    A3 --> C1
    A4 --> B5 & B7 & C3 & D3
    B1 --> B3
    B2 --> B3
    B3 --> B4
    B4 --> B5
    B5 --> B6 & B7
    C1 --> C2
    C2 --> C3
    C3 --> C4
    C4 --> C5
    D1 --> D3
    D2 --> D3
    D3 --> D4
    D4 --> D5
    B2 --> n1

    A1@{ shape: rect}
     A1:::source
     A2:::source
     A3:::source
     A4:::source
     B1:::process1
     B2:::process1
     B3:::process1
     B4:::process1
     B5:::process1
     B6:::process1
     B7:::process1
     C1:::process2
     C2:::process2
     C3:::process2
     C4:::process2
     C5:::process2
     D1:::process3
     D2:::process3
     D3:::process3
     D4:::process3
     D5:::process3
    classDef source fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef process1 fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    classDef process2 fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef process3 fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    classDef output fill:#E1F5FE,stroke:#0277BD,stroke-width:3px